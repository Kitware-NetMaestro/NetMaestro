{% load static %}
<!-- Data file selection dropdown -->
<div
    class="dropdown dropdown-end"
    x-data="dataFileSelector"
    @click.outside="open = false"
>
    <button
        class="btn btn-ghost btn-lg w-15 font-thin"
        type="button"
        @click="open = !open; if (open && !loaded) { refresh(); }"
        aria-label="Select data files"
    >
        <i class="ri-file-line"></i>
    </button>
    <div
        class="dropdown-content z-[1] card card-compact w-96 bg-base-200 shadow"
        x-show="open"
        @click.stop
    >
        <div class="card-header m-3">
            <div class="flex items-center justify-between mb-2">
                <h3 class="card-title">Data Files</h3>
                <button
                    class="btn btn-ghost btn-sm"
                    type="button"
                    @click.prevent.stop="refresh()"
                    aria-label="Update file list"
                >
                    <i
                        class="ri-loop-right-line text-base"
                        :class="refreshing ? 'animate-spin' : ''"
                        aria-hidden="true"
                    ></i>
                </button>
            </div>
            <hr/>
        </div>
        <div class="card-body py-3">
            <div class="space-y-4">
                <!-- Simulations file list -->
                <details open>
                    <summary class="text-base">Simulations</summary>
                    <div class="mt-2 space-y-1">
                        <template x-for="file in files.simulations" :key="file">
                            <label class="flex items-center gap-3 text-sm">
                                <input
                                    class="radio radio-sm"
                                    type="radio"
                                    name="simulation_file"
                                    :value="file"
                                    :checked="file === selected.simulations"
                                    @change="select('simulations', file)"
                                />
                                <span class="truncate" x-text="file"></span>
                            </label>
                        </template>
                        <div
                            class="opacity-70 text-sm"
                            x-show="loaded && files.simulations.length === 0"
                        >
                            No files found
                        </div>
                    </div>
                </details>

                <!-- Events file list -->
                <details open>
                    <summary class="text-base">Events</summary>
                    <div class="mt-2 space-y-1">
                        <template x-for="file in files.events" :key="file">
                            <label class="flex items-center gap-3 text-sm">
                                <input
                                    class="radio radio-sm"
                                    type="radio"
                                    name="event_file"
                                    :value="file"
                                    :checked="file === selected.events"
                                    @change="select('events', file)"
                                />
                                <span class="truncate" x-text="file"></span>
                            </label>
                        </template>
                        <div
                            class="opacity-70 text-sm"
                            x-show="loaded && files.events.length === 0"
                        >
                            No files found
                        </div>
                    </div>
                </details>

                <!-- Models file list -->
                <details open>
                    <summary class="text-base">Models</summary>
                    <div class="mt-2 space-y-1">
                        <template x-for="file in files.models" :key="file">
                            <label class="flex items-center gap-3 text-sm">
                                <input
                                    class="radio radio-sm"
                                    type="radio"
                                    name="model_file"
                                    :value="file"
                                    :checked="file === selected.models"
                                    @change="select('models', file)"
                                />
                                <span class="truncate" x-text="file"></span>
                            </label>
                        </template>
                        <div
                            class="opacity-70 text-sm"
                            x-show="loaded && files.models.length === 0"
                        >
                            No files found
                        </div>
                    </div>
                </details>
            </div>
        </div>
        <div class="card-footer">
            <div class="mt-auto px-2 pb-2">
                <!-- Load Data button: clears cache and increments loadTick to trigger plot updates -->
                <button
                    class="btn btn-primary w-full"
                    type="button"
                    @click="$store.dataStore.clearCache(); $store.dataStore.loadTick++; open = false"
                >
                    <span>Load Data</span>
                </button>
            </div>
        </div>
    </div>
</div>
